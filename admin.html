<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
  <!-- Favicon -->
  <link rel="icon" sizes="192x192" href="images/favicon.ico" />
  <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />


    
    <script src="assets/js/mainFlow.js"></script>
    <!-- Custom Stylesheet 
    <link rel="stylesheet" href="styles.css">
-->
<style>
    /* Universal Reset and Body Styling */
    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }
    
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f0f3f8;
        color: #333;
        line-height: 1.6;
    }
    
    .container {
        width: 90%;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }
    
    h1, h2, h3 {
        color: #00509e;
        margin-bottom: 20px;
    }

    /* Header Styling */
    header {
        background-color: #0056b3;
        color: #fff;
        padding: 15px 0;
        text-align: center;
    }

    header nav ul {
        list-style: none;
    }

    header nav ul li {
        display: inline;
        margin: 0 15px;
    }

    header nav ul li a {
        color: #fff;
        text-decoration: none;
        font-weight: bold;
    }

    /* Login Section */
    #login-section, #admin-dashboard {
        width: 100%;
        max-width: 700px;
        margin: 20px auto;
        padding: 20px;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        text-align: center;
    }
    
    #google-login-btn {
        background-color: #4285F4;
        color: white;
        padding: 12px 20px;
        font-size: 1rem;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    #google-login-btn:hover {
        background-color: #357AE8;
    }

    /* Dashboard Buttons */
    #admin-dashboard button {
        background-color: #00a65a;
        color: white;
        padding: 12px 25px;
        margin: 10px;
        font-size: 1rem;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    #admin-dashboard button:hover {
        background-color: #008d4c;
    }

    /* Table Styling */
    table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
        background: #fff;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    th, td {
        padding: 14px;
        text-align: center;
    }

    th {
        background-color: #0056b3;
        color: white;
        font-weight: bold;
    }

    td {
        background-color: #f9f9f9;
        border-bottom: 1px solid #ddd;
    }

    tr:nth-child(even) td {
        background-color: #f1f5f8;
    }

    /* Interactive Sections */
    #analytics-section, #contact-messages {
        display: none;
    }

    /* Footer Style */
    footer {
        text-align: center;
        padding: 10px;
        font-size: 0.9rem;
        color: #666;
        background: #e2eaf3;
    }

</style>

</head>





    <body>
<!-- Header Section -->
<header id="header">



    <!-- Main Navigation Section with Detailed Titles and ARIA Labels -->
    <nav aria-label="Main Site Navigation">
        <ul class="main-nav">
            <li><a href="https://rw-501.github.io/Portfolio/#about" title="Learn More About Ronald Wilson II">About Me</a></li>
            <li><a href="https://rw-501.github.io/Portfolio/#work" title="View My Portfolio Projects">Projects</a></li>
            <li><a href="https://rw-501.github.io/Portfolio/#bizz" title="Explore My Business Ventures">Business</a></li>
            <li><a href="https://www.linkedin.com/in/lrpinc/" title="Connect with Ronald Wilson II on LinkedIn">LinkedIn</a></li>
            <li><a href="https://rw-501.github.io/Portfolio/#projects" title="Explore Ongoing Projects by Ronald Wilson II">Active Projects</a></li>
        </ul>
    </nav>
</header>

    <!-- Login Section -->
    <div id="login-section">
        <h2>Admin Login</h2>
        <button id="google-login-btn">Login with Google</button>
    </div>

    <!-- Admin Dashboard Section -->
    <div id="admin-dashboard" style="display:none;">
        <h2>Admin Dashboard</h2>
        <p>Welcome, <span id="admin-name"></span></p>

        <button id="updateDataBtn">Update Data</button>

        <div>
            <button id="view-analytics-btn">View Analytics</button>
            <button id="read-contact-btn">Read Contact Messages</button>
            <button id="Guestbook-btn">Guestbook Messages</button>

            <button id="manage-social-media-btn">Manage Social Media</button>
            <button id="manage-websites-btn">Manage Websites</button>
        </div>

        <!-- Analytics Section -->
        <div id="analytics-section" class="views" >
            <h3>Analytics Data</h3>
            <table id="analyticsTable">
                <thead>
                    <tr>
                        <th>Page</th>
                        <th>Device Type</th>
                        <th>Browser</th>
                        <th>OS</th>
                        <th>Time on Page (s)</th>
                        <th>Screen Resolution</th>
                        <th>Location</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody  id="analyticsTableBody">
                </tbody>
            </table>
        </div>

        <td>${userIP || "N/A"}</td>
        <td>${guestName}</td>
        <td>${guestbookMessage}</td>
        <td>${contactMessage}</td>
        <td>${data.viewed ? `${data.viewed.entry.location.city}, ${data.viewed.entry.location.state}` : "N/A"}</td>
        <td>${data.currentDate || "N/A"}</td>


        <!-- Contact Messages Section -->
        <div id="contact-messages" class="views" >
            <h3>Contact Messages</h3>
            <table id="contactTable">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Message</th>
                        <th>Timestamp</th>
                    </tr>
                </thead>
                <tbody  id="contactTableBody">
                </tbody>
            </table>
        </div>
    </div>


        <!-- Guestbook Messages Section -->
        <div id="Guestbook-messages" class="views" >
            <h3>Contact Messages</h3>
            <table id="GuestbookTable">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Message</th>
                        <th>Timestamp</th>
                        <th>UserIP</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody  id="GuestbookTableBody">
                </tbody>
            </table>
        </div>
    </div>


    <!-- Firebase Scripts (using Firebase v9) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-analytics.js";
    
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCsitF_YPDGnMwK0xIk2tUgQXJnxS2HN_o",
            authDomain: "ron-main.firebaseapp.com",
            projectId: "ron-main",
            storageBucket: "ron-main.appspot.com",
            messagingSenderId: "885898378176",
            appId: "1:885898378176:web:ee850a5c980b4417a2a625",
            measurementId: "G-Y16GN7VL5Q"
        };
    
        // Initialize Firebase and services
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const analytics = getAnalytics(app);
    // Function to check login state on page load
function checkLoginStatus() {
    const userData = JSON.parse(localStorage.getItem('userData'));

    if (userData && userData.email === '1988lrp@gmail.com') {
        document.getElementById('login-section').style.display = 'none';
        document.getElementById('admin-dashboard').style.display = 'block';
        document.getElementById('admin-name').textContent = userData.name;
    } else {
        document.getElementById('login-section').style.display = 'block';
        document.getElementById('admin-dashboard').style.display = 'none';
    }
}

// Run this function when the page loads
document.addEventListener("DOMContentLoaded", checkLoginStatus);

// Google Sign-In
const googleLoginBtn = document.getElementById('google-login-btn');
googleLoginBtn.addEventListener('click', async () => {
    const provider = new GoogleAuthProvider();
    try {
        const result = await signInWithPopup(auth, provider);
        const user = result.user;

        if (user.email === '1988lrp@gmail.com') {
            // Save user data to Local Storage
            localStorage.setItem('userData', JSON.stringify({
                name: user.displayName,
                email: user.email
            }));

            document.getElementById('login-section').style.display = 'none';
            document.getElementById('admin-dashboard').style.display = 'block';
            document.getElementById('admin-name').textContent = user.displayName;
        } else {
            alert('Unauthorized Email');
            await signOut(auth);
        }
    } catch (error) {
        console.error("Google Sign-In Error:", error);
    }
});

// Logout function
function logout() {
    signOut(auth).then(() => {
        // Clear Local Storage
        localStorage.removeItem('userData');

        // Hide Admin Dashboard, Show Login
        document.getElementById('admin-dashboard').style.display = 'none';
        document.getElementById('login-section').style.display = 'block';
    }).catch(error => {
        console.error("Error signing out:", error);
    });
}

async function fetchDataWithCache(cacheKey, fetchFunction) {
    const cachedData = localStorage.getItem(cacheKey);

    if (cachedData) {
        console.log(`Loaded ${cacheKey} from cache.`);
        return JSON.parse(cachedData);
    }

    const freshData = await fetchFunction();
    localStorage.setItem(cacheKey, JSON.stringify(freshData));
    return freshData;
}

function clearCache() {
    localStorage.removeItem("analyticsData");
    localStorage.removeItem("guestbookData");
    localStorage.removeItem("contactData");
    showToast("Cache Cleared! Fetching new data...", "info");
}

  // Fetch Analytics Data
  async function fetchAnalytics() {
    return new Promise(async (resolve) => {
        const logsTableBody = document.getElementById("analyticsTableBody");
        logsTableBody.innerHTML = "";

        const querySnapshot = await getDocs(collection(db, "portfolioAnalytics"));
        let analyticsData = [];

        const guestbookData = await fetchDataWithCache("guestbookData", fetchGuestbookMessages);
        const contactData = await fetchDataWithCache("contactData", fetchContactMessages);

        querySnapshot.forEach(doc => {
            const data = doc.data();
            const userIP = data.ipAddress;
            const guestName = data.guestName || "Visitor";

            // Match with Guestbook
            const guestbookEntry = guestbookData.find(entry => entry.userIP === userIP);
            const guestbookMessage = guestbookEntry ? guestbookEntry.message : "None";

            // Match with Contacts
            const contactEntry = contactData.find(entry => entry.userIP === userIP);
            const contactMessage = contactEntry ? contactEntry.message : "None";

            const mainRow = document.createElement("tr");
            mainRow.innerHTML = `
                <td>${userIP || "N/A"}</td>
                <td>${guestName}</td>
                <td>${guestbookMessage}</td>
                <td>${contactMessage}</td>
                <td>${data.viewed ? `${data.viewed.entry.location.city}, ${data.viewed.entry.location.state}` : "N/A"}</td>
                <td>${data.currentDate || "N/A"}</td>
            `;
            // Check if the 'viewed' array exists and is an array before iterating
            if (Array.isArray(data.viewed)) {

const area = document.createElement("div");

data.viewed.forEach((entry) => {
    const row = document.createElement("tr");

    row.innerHTML = `
        <td>${entry.page || "N/A"}</td>
        <td>${entry.deviceType || "N/A"}</td>
        <td>${entry.browser || "N/A"}</td>
        <td>${entry.operatingSystem || "N/A"}</td>
        <td>${entry.timeOnPage || "N/A"}</td>
        <td>${entry.screenWidth}x${entry.screenHeight}</td>
        <td>${entry.location ? `${entry.location.city || 'Unknown'}, ${entry.location.state || 'Unknown'}, ${entry.location.country || 'Unknown'}` : "N/A"}</td>
        <td>${entry.currentDate || "N/A"}</td>
        `;

    area.appendChild(row);
});
mainRow.appendChild(area);

} else {

}



            logsTableBody.appendChild(mainRow);
            analyticsData.push({ ...data, guestbookMessage, contactMessage });
        });

        localStorage.setItem("analyticsData", JSON.stringify(analyticsData));
        resolve(analyticsData);
    });
}


async function fetchGuestbookMessages() {
    return new Promise(async (resolve) => {
        const GuestbookTable = document.getElementById("GuestbookTableBody");
        GuestbookTable.innerHTML = "";

        const querySnapshot = await getDocs(collection(db, "Guestbook"));
        let guestbookData = [];

        querySnapshot.forEach(doc => {
            const data = doc.data();
            guestbookData.push({ ...data, id: doc.id });

            const mainRow = GuestbookTable.insertRow();
            mainRow.innerHTML = `
                <td>${data.name}</td>
                <td>${data.message}</td>
                <td>${data.timestamp.toDate().toLocaleString()}</td>
                <td>${data.userIP}</td>
                <td>
                    <select class="status-dropdown" data-id="${doc.id}">
                        <option value="active" ${data.status === 'active' ? 'selected' : ''}>Active</option>
                        <option value="pending" ${data.status === 'pending' ? 'selected' : ''}>Pending</option>
                        <option value="archived" ${data.status === 'archived' ? 'selected' : ''}>Archived</option>
                    </select>
                </td>
            `;
        });

        localStorage.setItem("guestbookData", JSON.stringify(guestbookData));
        resolve(guestbookData);
    });



    // Attach event listeners to all dropdowns
    document.querySelectorAll('.status-dropdown').forEach(select => {
        select.addEventListener('change', async (event) => {
            const newStatus = event.target.value;
            const docId = event.target.getAttribute('data-id');

            try {
                await updateDoc(doc(db, 'Guestbook', docId), { status: newStatus });
                showToast(`Status updated to: ${newStatus}`, "success");
            } catch (error) {
                console.error("Error updating status:", error);
                showToast("Failed to update status", "error");
            }
        });
    });
}

// Fetch Contact Messages
async function fetchContactMessages() {
    return new Promise(async (resolve) => {
        const contactTable = document.getElementById("contactTableBody");
        contactTable.innerHTML = "";

        const querySnapshot = await getDocs(collection(db, "portfolioContact"));
        let contactData = [];

        querySnapshot.forEach(doc => {
            const data = doc.data();
            contactData.push({ ...data, id: doc.id });

            const mainRow = contactTable.insertRow();
            mainRow.innerHTML = `
                <td>${data.name}</td>
                <td>${data.email}</td>
                <td>${data.message}</td>
                <td>${data.timestamp.toDate().toLocaleString()}</td>
                <td>
                    <select class="status-dropdown" data-id="${doc.id}">
                        <option value="unread" ${data.status === 'unread' ? 'selected' : ''}>Unread</option>
                        <option value="read" ${data.status === 'read' ? 'selected' : ''}>Read</option>
                        <option value="resolved" ${data.status === 'resolved' ? 'selected' : ''}>Resolved</option>
                    </select>
                </td>
            `;

            if (Array.isArray(data.location)) {

const area = document.createElement("div");

data.location.forEach((entry) => {
    const row = document.createElement("tr");

    row.innerHTML = `
        <td>${entry.city || "N/A"}</td>
        <td>${entry.state || "N/A"}</td>
        <td>${entry.zip || "N/A"}</td>
        <td>${entry.country || "N/A"}</td>
        <td>${entry.location ? `${entry.location.city || 'Unknown'}, ${entry.location.state || 'Unknown'}, ${entry.location.country || 'Unknown'}` : "N/A"}</td>
    `;

    area.appendChild(row);
});
mainRow.appendChild(area);
            }



        });

        localStorage.setItem("contactData", JSON.stringify(contactData));
        resolve(contactData);
    });



    // Attach event listeners to all dropdowns
    document.querySelectorAll('.status-dropdown').forEach(select => {
        select.addEventListener('change', async (event) => {
            const newStatus = event.target.value;
            const docId = event.target.getAttribute('data-id');

            try {
                await updateDoc(doc(db, 'portfolioContact', docId), { status: newStatus });
                showToast(`Status updated to: ${newStatus}`, "success");
            } catch (error) {
                console.error("Error updating status:", error);
                showToast("Failed to update status", "error");
            }
        });
    });
}

// Function to hide all elements with the class "views"
function hideAllViews() {
    document.querySelectorAll('.views').forEach(view => {
        view.style.display = 'none';
    });
}

// Event Listeners to show specific sections
document.getElementById('view-analytics-btn').addEventListener('click', () => {
    hideAllViews(); // Hide all "views" sections
    document.getElementById('analytics-section').style.display = 'block';
    fetchAnalytics();
});

document.getElementById('read-contact-btn').addEventListener('click', () => {
    hideAllViews();
    document.getElementById('contact-messages').style.display = 'block';
    fetchContactMessages();
});

document.getElementById('Guestbook-btn').addEventListener('click', () => {
    hideAllViews();
    document.getElementById('Guestbook-messages').style.display = 'block';
    fetchGuestbookMessages();
});




document.getElementById("updateDataBtn").addEventListener("click", async () => {
    clearCache();
    await fetchAnalytics();
    await fetchGuestbookMessages();
    await fetchContactMessages();
});


   


   // JavaScript functions for handling website actions
   function updateWebsite(websiteId) {
        const status = document.getElementById(`status-${websiteId}`).value;
        const keywords = document.getElementById(`keywords-${websiteId}`).value;
        alert(`Updated ${websiteId}: Status - ${status}, Keywords - ${keywords}`);
        
        // AJAX request to update the status and keywords in the database
    }

    function deleteWebsite(websiteId) {
        if (confirm(`Are you sure you want to delete ${websiteId}?`)) {
            alert(`Deleted ${websiteId}`);
            
            // AJAX request to delete the website from the database
        }
    }


    
</script>



</body>

</html>
